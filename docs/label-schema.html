<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Label Schema | About Jefferys’ Dockers</title>
  <meta name="description" content="The BookDown website for the Dockers hosted at Jefferys/JefferysDockers on GitHub." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Label Schema | About Jefferys’ Dockers" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jefferysdockers.github.io/" />
  
  <meta property="og:description" content="The BookDown website for the Dockers hosted at Jefferys/JefferysDockers on GitHub." />
  <meta name="github-repo" content="JefferysDockers/JefferysDockers.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Label Schema | About Jefferys’ Dockers" />
  
  <meta name="twitter:description" content="The BookDown website for the Dockers hosted at Jefferys/JefferysDockers on GitHub." />
  

<meta name="author" content="Stuart R. Jefferys" />


<meta name="date" content="2020-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="build-methodology.html"/>
<link rel="next" href="other-label-schemas.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Jefferys' Dockers</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>JefferysDockers</a></li>
<li class="chapter" data-level="1" data-path="dockers.html"><a href="dockers.html"><i class="fa fa-check"></i><b>1</b> Dockers</a><ul>
<li class="chapter" data-level="1.1" data-path="dockers.html"><a href="dockers.html#base-dockers"><i class="fa fa-check"></i><b>1.1</b> Base Dockers</a><ul>
<li class="chapter" data-level="1.1.1" data-path="dockers.html"><a href="dockers.html#ubu-lts---ubuntu-long-term-support-release"><i class="fa fa-check"></i><b>1.1.1</b> ubu-lts - Ubuntu Long Term Support Release</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="build-methodology.html"><a href="build-methodology.html"><i class="fa fa-check"></i><b>2</b> Build methodology</a></li>
<li class="chapter" data-level="3" data-path="label-schema.html"><a href="label-schema.html"><i class="fa fa-check"></i><b>3</b> Label Schema</a><ul>
<li class="chapter" data-level="3.1" data-path="label-schema.html"><a href="label-schema.html#the-label-instruction"><i class="fa fa-check"></i><b>3.1</b> The LABEL instruction</a></li>
<li class="chapter" data-level="3.2" data-path="label-schema.html"><a href="label-schema.html#image-label-standards"><i class="fa fa-check"></i><b>3.2</b> Image label standards</a></li>
<li class="chapter" data-level="3.3" data-path="label-schema.html"><a href="label-schema.html#better-heritable-tags"><i class="fa fa-check"></i><b>3.3</b> Better heritable tags</a><ul>
<li class="chapter" data-level="3.3.1" data-path="label-schema.html"><a href="label-schema.html#adding-image-namespaces."><i class="fa fa-check"></i><b>3.3.1</b> Adding image namespaces.</a></li>
<li class="chapter" data-level="3.3.2" data-path="label-schema.html"><a href="label-schema.html#specifying-the-image-hierarchy"><i class="fa fa-check"></i><b>3.3.2</b> Specifying the image hierarchy</a></li>
<li class="chapter" data-level="3.3.3" data-path="label-schema.html"><a href="label-schema.html#parsing-the-image-chain"><i class="fa fa-check"></i><b>3.3.3</b> Parsing the image chain</a></li>
<li class="chapter" data-level="3.3.4" data-path="label-schema.html"><a href="label-schema.html#verifying-the-last-image-in-the-chain"><i class="fa fa-check"></i><b>3.3.4</b> Verifying the last image in the chain</a></li>
<li class="chapter" data-level="3.3.5" data-path="label-schema.html"><a href="label-schema.html#an-example-of-parsing-an-image-chain-from-labels"><i class="fa fa-check"></i><b>3.3.5</b> An example of parsing an image chain from labels</a></li>
<li class="chapter" data-level="3.3.6" data-path="label-schema.html"><a href="label-schema.html#summary"><i class="fa fa-check"></i><b>3.3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="label-schema.html"><a href="label-schema.html#io.github.jefferysdockers-label-schema"><i class="fa fa-check"></i><b>3.4</b> io.github.jefferysdockers Label Schema</a><ul>
<li class="chapter" data-level="3.4.1" data-path="label-schema.html"><a href="label-schema.html#required-prefixes"><i class="fa fa-check"></i><b>3.4.1</b> Required prefixes</a></li>
<li class="chapter" data-level="3.4.2" data-path="label-schema.html"><a href="label-schema.html#required-labels"><i class="fa fa-check"></i><b>3.4.2</b> Required labels</a></li>
<li class="chapter" data-level="3.4.3" data-path="label-schema.html"><a href="label-schema.html#optional-labels"><i class="fa fa-check"></i><b>3.4.3</b> Optional Labels</a></li>
<li class="chapter" data-level="3.4.4" data-path="label-schema.html"><a href="label-schema.html#example-build-script"><i class="fa fa-check"></i><b>3.4.4</b> Example build script</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-label-schemas.html"><a href="other-label-schemas.html"><i class="fa fa-check"></i><b>4</b> Other Label Schemas</a><ul>
<li class="chapter" data-level="4.1" data-path="other-label-schemas.html"><a href="other-label-schemas.html#open-containers-standard"><i class="fa fa-check"></i><b>4.1</b> Open Containers Standard</a><ul>
<li class="chapter" data-level="4.1.1" data-path="other-label-schemas.html"><a href="other-label-schemas.html#labels"><i class="fa fa-check"></i><b>4.1.1</b> Labels</a></li>
<li class="chapter" data-level="4.1.2" data-path="other-label-schemas.html"><a href="other-label-schemas.html#keys"><i class="fa fa-check"></i><b>4.1.2</b> Keys</a></li>
<li class="chapter" data-level="4.1.3" data-path="other-label-schemas.html"><a href="other-label-schemas.html#values"><i class="fa fa-check"></i><b>4.1.3</b> Values</a></li>
<li class="chapter" data-level="4.1.4" data-path="other-label-schemas.html"><a href="other-label-schemas.html#pre-defined-keys"><i class="fa fa-check"></i><b>4.1.4</b> Pre-defined keys</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="other-label-schemas.html"><a href="other-label-schemas.html#biocontainers-standard"><i class="fa fa-check"></i><b>4.2</b> Biocontainers Standard</a><ul>
<li class="chapter" data-level="4.2.1" data-path="other-label-schemas.html"><a href="other-label-schemas.html#pre-defined-keys-required"><i class="fa fa-check"></i><b>4.2.1</b> Pre-defined keys (required):</a></li>
<li class="chapter" data-level="4.2.2" data-path="other-label-schemas.html"><a href="other-label-schemas.html#pre-defined-keys-optional"><i class="fa fa-check"></i><b>4.2.2</b> Pre-defined keys (optional):</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">About Jefferys’ Dockers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="label-schema" class="section level1">
<h1><span class="header-section-number">3</span> Label Schema</h1>
<p><em>Note:</em> I’m only considering labels on images built from Dockerfiles, not images modified interactively and then saved and shared.</p>
<div id="the-label-instruction" class="section level2">
<h2><span class="header-section-number">3.1</span> The LABEL instruction</h2>
<p>The goal of the <code>LABEL</code> Dockerfile instruction is to specify metadata as key=“value” entries that can be inspected, e.g. with <code>docker info &lt;imageName&gt;</code>. Labels can also be added at build time by using the <code>docker build --label &quot;key=value&quot;</code> option.</p>
<p><em>Note:</em> Adding a label at build time could break the build cache, but it is implemented smartly; labels are added at the end of the build, so if a new or different label is added to a previously-run build command, everything is preserved except for the final step. Even the “add labels” step is cached and reused if the build command uses the same labels [SRJ in the same order?].</p>
</div>
<div id="image-label-standards" class="section level2">
<h2><span class="header-section-number">3.2</span> Image label standards</h2>
<p>There are more than one labeling standard, none of which are complete. So I just use them for source info on what kinds of labels I want. My notes on them follow in the sections <a href="other-label-schemas.html#open-containers-standard">Open Containers Standard</a>{open-containers-standard} and <a href="biocontainers%20standard">Biocontainers Standard</a></p>
<p>What’s missing is that metadata needs to be inherited in a hierarchy, not flat. Flat means values inherited from parents are lost when a child declares a label of the same name, and if a child does not define a label the parent does, it is inherited with no indication of where it came from - e.g. the email of the maintainer.</p>
<p>To add this without changing how docker formats labels is the trick. It requires every <em>image</em> to have its own unique namespace prefix that is used as a prefix for all its labels. Then each (reverse-domain-name prefixed) label inherited is preserved and associate with a specific parent image.</p>
</div>
<div id="better-heritable-tags" class="section level2">
<h2><span class="header-section-number">3.3</span> Better heritable tags</h2>
<div id="adding-image-namespaces." class="section level3">
<h3><span class="header-section-number">3.3.1</span> Adding image namespaces.</h3>
<p>The reverse-domain name of the image hosting site provides an ideal unique name, when combined with the image name (with “/” replaced by “.”). Since <code>com.dockerhub.*</code> is reserved, docker-hub hosted images have only the name. For a quick example:</p>
<p>A <code>io.github.JefferysDockers.pull</code> label is intended to hold the exact syntax needed to pull an image in a docker pull statement. If the image to be labeled is hosted at DockerHub in a repository named <code>jefferys/ubu-lts</code>, the label can be added either in the Dockerfile using the <code>LABEL</code> command or on the build command line using the <code>--label</code> option. In the Dockerfile this would look like</p>
<pre><code>    LABEL jefferys.ubu-lts.io.github.JefferysDockers.pull=&quot;jefferys/ubu-lts:20.04.01-0.0.1&quot;</code></pre>
<p>On the docker build command line it would look like</p>
<pre><code>    docker build --label &quot;jefferys.ubu-lts.io.github.JefferysDockers.pull=jefferys/ubu-lts:20.04.01-0.0.1&quot;</code></pre>
<p>In general no image will have a different version of itself as its base (or as any base, recursively), so tags are not used to identify images uniquely. If necessary in some specific instance they could always be used.</p>
</div>
<div id="specifying-the-image-hierarchy" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Specifying the image hierarchy</h3>
<p>In order to tell which tag goes with which inherited image, and which is from the current, a special (prefixed) label: <code>io.github.JefferysDockers.base-prefix</code> must be included that identifies the prefix the parent uses. An image defined from scratch has <code>base-prefix=&quot;scratch&quot;</code>. If the parent does not conform to this labeling schema, <code>base-prefix=&quot;&quot;</code>, the empty string.</p>
<p>When the recursive chain of images all conform, the chain of images can be recreated by parsing all base-prefix labels. The base-prefix label whose base prefix is not specified by any base-prefix is then the most recent. For example a scratch image <code>ubu-lts</code> providing an Ubuntu OS could define:</p>
<pre><code>    LABEL jefferys.ubu-lts.io.github.JefferysDockers.base-prefix=&quot;scratch&quot;</code></pre>
<p>An image <code>r-lang</code> that provided the R programming environment that used “ubu-lts” as its base image could define</p>
<pre><code>    LABEL jefferys.r-lang.io.github.JefferysDockers.base-prefix=&quot;jefferys.ubu-lts&quot;</code></pre>
<p>The <code>r-lang</code> image will inherit the labels from its base, and since the prefix of the <code>base-prefix</code> label differs, both the parent’s and the child’s labels are present.</p>
<p>Adding third “application” image that provided an R programming framework called <code>my-app</code> that had <code>r-lang</code> as its base could define:</p>
<pre><code>    LABEL jefferys.my-app.io.github.JefferysDockers.base-prefix=&quot;jefferys.r-lang&quot;</code></pre>
<p>Its image will inherit its base image labels, which inherits its own base’s image labels, etc. So the labels on the image <code>my-app</code> include all three <code>base-prefix</code> label variants:</p>
<pre><code>    jefferys.ubu-lts.io.github.JefferysDockers.base-prefix=&quot;scratch&quot;
    jefferys.r-lang.io.github.JefferysDockers.base-prefix=&quot;jefferys.ubu-lts&quot;
    jefferys.my-app.io.github.JefferysDockers.base-prefix=&quot;jefferys.r-lang&quot;</code></pre>
</div>
<div id="parsing-the-image-chain" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Parsing the image chain</h3>
<p>Parsing the image prefix from each <code>io.github.JefferysDockers.base-prefix</code> label and associating it with the label value allows reconstructing the chain of images and identifies the current image:</p>
<p><code>jefferys.ubu-lts</code> had base <code>scratch</code>
<code>jefferys.r-lang</code> had base <code>jefferys.ubu-lts</code>
<code>jefferys.my-app</code> had base <code>jefferys.r-lang</code></p>
<p>As <code>jefferys.my-app</code> appeared in no base-prefix label, it is the current image.</p>
<p>If we know that all images in the image chain are labeled to conform with this <code>io.github.JefferysDockers</code> standard, then this is all we need. However, it is likely that some image or images in the chain will be non-conforming and labeled in some other way. If a non-conforming image is used anywhere in the chain of images, as the labels on the current image are inherited from all parents, the current image will be non-confirming. It will then not be possible to determine where its labels or the labels it inherits came from. Although that is no different then the current default situation with labels, we would need to be able to detect non-conforming images, and it would be nice to use the labels from any images that do conform.</p>
<p>It is always possible to identify a conforming “scratch” base image and a continuous chain of images up to a non-conforming one. But it is not possible to determine if the current image is conforming inspecting “base-prefix” labels on the image. If the current image declares no labels, it will not be detected even if all the other images in the chain are conforming.</p>
</div>
<div id="verifying-the-last-image-in-the-chain" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Verifying the last image in the chain</h3>
<p>Unfortunately there seems no way to identify the current image as a conforming image using just the <code>docker inspect</code> command. It is not possible to specify a label that is not inherited, and if it were possible to identify which image in a chain of images a particular label came from, there would be little need for this schema. But there is another tool available to examine images, the <code>docker history</code> command.</p>
<p>The <code>docker history</code> command provides information on each build step used to generate an image, including the steps used to build its base image, and its base’s base image, recursively. But although it lists the steps in order, it does not identify which image a step came from - the line between the steps in an image and in its base is not preserved. If it was, we could just use the history information instead of label prefixes to identify what image a label was specified for. But we do have an ordering, so we can tell which is the last step, which must come from the last image. If we can identify the last step as a step the builds a conforming image, we know the current image is conforming and can trace all the labels back to the first non-conforming image.</p>
<p>To ensure the current image is detectable as a conforming image, we specify that the last instructions in the image history must be one or more LABEL instructions, and one of the labels set must be (an image namespace prefixed) “io.github.JefferysDockers.label-schema-version” label. When searching backwards through the output of the docker history command, if anything other than a LABEL instruction is encountered before the required “io.github.JefferysDockers.label-schema-version” label, the current image is non-conforming. Docker generally alphabetizes the label instructions based on the label name, so always need to look through the set of all label instruction at the end of the file, not just the last one. (The label keys are also alphabetized in the in the results from inspecting the image.)</p>
</div>
<div id="an-example-of-parsing-an-image-chain-from-labels" class="section level3">
<h3><span class="header-section-number">3.3.5</span> An example of parsing an image chain from labels</h3>
<p>For example, an image might contains the labels:</p>
<pre><code>    jefferys.my-app.io.github.JefferysDockers.base-prefix=&quot;&quot;
    jefferys.my-app.io.github.JefferysDockers.label-schema-version=&quot;0.0.2&quot;
    jefferys.ubu-lts.io.github.JefferysDockers.base-prefix=&quot;scratch&quot;
    jefferys.ubu-lts.io.github.JefferysDockers.label-schema-version=&quot;0.0.1&quot;</code></pre>
<p>And the most recent command indicated in history output is</p>
<pre><code>    LABEL jefferys.my-app.io.github.JefferysDockers.label-schema-version=&quot;0.0.2&quot;</code></pre>
<p>This can then be parsed forwards from the scratch image, which is a conforming image and has labels with prefix <code>jefferys.ubu-lts</code>. There is at least one non-conforming image in the image chain as the image that used <code>ubu-lts</code> as its base is not identifiable.</p>
<p>It can also be parsed backwards from the current image, which is a conforming image and has labels with the prefix <code>&quot;jefferys.my-app&quot;</code>. The base of the current image is non-conforming, and so its prefix is specifically unspecified (as <code>&quot;&quot;</code>).</p>
<p>There is an unknown number of non-conforming images between the conforming scratch and the conforming current images.</p>
</div>
<div id="summary" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Summary</h3>
<p>The need to parse history and inspect output to determine image hierarchy and associate labels with images is not ideal, but there seems no other way to implement image-specific labels without support from the container specification itself. Doing so avoids the problems of stale image labels inherited by current images that don’t over-write them, stops one image from overwriting labels from base or prior images that might be important, and allows for accumulative labels that span the whole image, such as licenses. It is relatively robust and not too difficult to implement, requiring two specific labels per container.</p>
</div>
</div>
<div id="io.github.jefferysdockers-label-schema" class="section level2">
<h2><span class="header-section-number">3.4</span> io.github.jefferysdockers Label Schema</h2>
<div id="required-prefixes" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Required prefixes</h3>
<p>All labels must be prefixed by the full reverse domain name for the image pull command, converting slashes to periods and leaving out a leading <code>com.dockerhub.</code> if needed. For example, if an image primary hosting is at</p>
<pre><code>    dockerhub.com/jefferys/ubu-lts</code></pre>
<p>its prefix would be</p>
<pre><code>    jefferys.ubu-lts.</code></pre>
<p>Following the image prefix, images should be labeled by the reverse domain name of the schema where the labels are defined. This schema is defined at</p>
<pre><code>    jefferysdockers.github.io</code></pre>
<p>so its labels are specified with a prefix of</p>
<pre><code>    io.github.jefferysdockers.</code></pre>
<p>So in total, all labels from this schema in the above image would have a prefix of</p>
<pre><code>    jefferys.ubu-lts.io.github.jefferysdockers.</code></pre>
<p>Labels from other schema can be included in conforming containers, but must also have the image hosting prefix in addition to their domain specific labels, or even simple labels. For example other labels added to the image for some use cases might look like:</p>
<pre><code>    jefferys.ubu-lts.com.example.rating=&quot;10&quot;
    jefferys.ubu-lts.com.needs-mem=&quot;32G&quot;</code></pre>
<p>It is permissible to add a simple label like <code>needs-mem=&quot;32G&quot;</code> to an image for purely local use, but such labels should never be used on shared hosted images, and care must be taken by local users in labeling images used as the base for another.</p>
<p><em>Note:</em> Since there are required labels, and only conforming images should use the <code>io.github.jefferysdockers.</code> prefixes, it is always possible to parse the image name prefix preceding such a label, and hence user labels are can be parsed as well.</p>
</div>
<div id="required-labels" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Required labels</h3>
<ul>
<li>
<details>
<p><summary><strong><code>io.github.JefferysDockers.base-prefix</code></strong> - Declares the prefix used in the base image. […]</summary></p>
<p>By specifying the prefix the base image uses to identify <em>its</em> labels, image -&gt; base image relationships can be deduced. Must be <code>&quot;scratch&quot;</code> if an image has no base, and must be <code>&quot;&quot;</code> (the empty string) if the base image does not conform to the <code>io.github.JefferysDockers</code> labeling standard.</p>
<p><strong>Examples:</strong></p>
<pre><code>LABEL jefferys.ubu-lts.io.github.JefferysDockers.base-prefix=&quot;scratch&quot;
    
    LABEL jefferys.bioc.io.github.JefferysDockers.base-prefix=&quot;&quot;</code></pre>
</details>
</li>
<li>
<details>
<p><summary><strong><code>io.github.JefferysDockers.label-schema-version</code></strong> - The version of the <code>io.github.JefferysDockers</code> labeling schema a conforming image uses. […]</summary></p>
<p>Must be specified last in the Dockerfile or be followed only by LABEL statements. It may also be specified on the build command line using the <code>--label</code> option as those are added into the container at the end as <code>LABEL</code> instructions.</p>
<p><strong>Examples:</strong></p>
<pre><code>LABEL jefferys.ubu-lts.io.github.JefferysDockers.label-schema-version=&quot;0.0.1&quot;
    
    docker build --label &quot;jefferys.ubu-lts.io.github.JefferysDockers.label-schema-version=0.0.1&quot;</code></pre>
</details>
</li>
</ul>
<p>[TODO - CONTINUE FROM HERE]</p>
</div>
<div id="optional-labels" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Optional Labels</h3>
<p>[TODO - CONTINUE FROM HERE]</p>
</div>
<div id="example-build-script" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Example build script</h3>
<p>This is essentially the build.sh for the ubu-lts base Docker, with several
optimizations to use with DockerHub’s automated build environment, which
includes the environmental variables:</p>
<p><strong><code>$DOCKER_REPO</code></strong> - The base name of the repo that will be pulling and building this
<strong><code>$DOCKERFILE_PATH</code></strong> - The path to the Dockerfile, relative to the root of the build source repo.
<strong><code>&quot;TAG&quot;</code></strong> - The name of the file containing the full version tag to use, as <toolVer>-<buildVer></p>
<p>In reality this will be in a file “hooks/build”, the real build.sh in the repo just calls this script and provides values for the ENV variables above, if not specified</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># Label input parameters</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co"># Describing the image</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="va">imageName=</span><span class="st">&quot;</span><span class="va">${DOCKER_REPO}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="va">dockerfilePath=</span><span class="st">&quot;</span><span class="va">${DOCKERFILE_PATH}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="va">spdxLicense=</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="va">licenseFile=</span><span class="st">&quot;https://ubuntu.com/licensing&quot;</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="va">baseImagePrefix=</span><span class="st">&quot;scratch&quot;</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="va">title=</span><span class="st">&quot;</span><span class="va">${imageName}</span><span class="st"> - Base OS derived from Ubuntu.&quot;</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="va">description=</span><span class="st">&quot;Based on Ubuntu this is a completely local build of a base Docker from scratch.&quot;</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="va">keywords=</span><span class="st">&quot;Linux, Ubuntu, scratch, os&quot;</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co"># Describing the image&#39;s content (the included Ubuntu distro)</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="va">contentHome=</span><span class="st">&quot;https://wiki.ubuntu.com/Base&quot;</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="va">contentSource=</span><span class="st">&quot;http://cdimage.ubuntu.com/ubuntu-base/&quot;</span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="va">contentTitle=</span><span class="st">&quot;Ubuntu base os distribution&quot;</span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="va">contentDescription=</span><span class="st">&quot;Minimalist non-official functional distribution of Ubuntu, including apt-get&quot;</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="va">contentSpdxLicense=</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21"><span class="va">contentLicenseFile=</span><span class="st">&quot;https://ubuntu.com/licensing&quot;</span></a>
<a class="sourceLine" id="cb17-22" data-line-number="22"><span class="va">contentVendor=</span><span class="st">&quot;Canonical&quot;</span></a>
<a class="sourceLine" id="cb17-23" data-line-number="23"><span class="va">contentVendorUrl=</span><span class="st">&quot;https://canonical.com/&quot;</span></a>
<a class="sourceLine" id="cb17-24" data-line-number="24"></a>
<a class="sourceLine" id="cb17-25" data-line-number="25"><span class="co"># Independent of image and content</span></a>
<a class="sourceLine" id="cb17-26" data-line-number="26"><span class="va">labelSchemaVersion=</span><span class="st">&quot;0.0.1&quot;</span></a>
<a class="sourceLine" id="cb17-27" data-line-number="27"><span class="va">vendor=</span><span class="st">&quot;UNC - Lineberger&quot;</span></a>
<a class="sourceLine" id="cb17-28" data-line-number="28"><span class="va">vendorUrl=</span><span class="st">&quot;https://lbc.unc.edu/&quot;</span></a>
<a class="sourceLine" id="cb17-29" data-line-number="29"></a>
<a class="sourceLine" id="cb17-30" data-line-number="30"><span class="co"># Constant across my dockers</span></a>
<a class="sourceLine" id="cb17-31" data-line-number="31"><span class="va">labelSchema=</span><span class="st">&quot;io.github.JefferysDockers&quot;</span></a>
<a class="sourceLine" id="cb17-32" data-line-number="32"><span class="va">imageRepoOwner=</span><span class="st">&quot;jefferys&quot;</span></a>
<a class="sourceLine" id="cb17-33" data-line-number="33"><span class="va">sourceRepoOwner=</span><span class="st">&quot;JefferysDockers&quot;</span></a>
<a class="sourceLine" id="cb17-34" data-line-number="34"><span class="va">imageRepoRootUrl=</span><span class="st">&quot;https://hub.docker.com/r&quot;</span></a>
<a class="sourceLine" id="cb17-35" data-line-number="35"><span class="va">sourceRepoRootUrl=</span><span class="st">&quot;https://github.com&quot;</span></a>
<a class="sourceLine" id="cb17-36" data-line-number="36"><span class="va">maintainer=</span><span class="st">&quot;Stuart R. Jefferys &lt;stuart_jefferys@med.unc.edu&gt;&quot;</span></a>
<a class="sourceLine" id="cb17-37" data-line-number="37"></a>
<a class="sourceLine" id="cb17-38" data-line-number="38"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-39" data-line-number="39"><span class="co"># End of label input parameters</span></a>
<a class="sourceLine" id="cb17-40" data-line-number="40"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-41" data-line-number="41"></a>
<a class="sourceLine" id="cb17-42" data-line-number="42"><span class="co"># Get tag for image, and parse into parts: the before first &quot;-&quot; part (the tool</span></a>
<a class="sourceLine" id="cb17-43" data-line-number="43"><span class="co"># version) and the after first &quot;-&quot; part (the build version).</span></a>
<a class="sourceLine" id="cb17-44" data-line-number="44"><span class="bu">read</span> <span class="va">TAG</span> <span class="op">&lt;</span> <span class="st">&quot;TAG&quot;</span></a>
<a class="sourceLine" id="cb17-45" data-line-number="45"><span class="va">contentVersion=</span><span class="st">&quot;</span><span class="va">${TAG%%</span>-*<span class="va">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-46" data-line-number="46"><span class="va">sourceVersion=</span><span class="st">&quot;</span><span class="va">${TAG#</span>*-<span class="va">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-47" data-line-number="47"></a>
<a class="sourceLine" id="cb17-48" data-line-number="48"><span class="co"># Time created</span></a>
<a class="sourceLine" id="cb17-49" data-line-number="49"><span class="va">created=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> <span class="st">&quot;+%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="va">)</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-50" data-line-number="50"><span class="va">afterPos=$((</span> <span class="va">${#created}</span> - 2 <span class="va">))</span></a>
<a class="sourceLine" id="cb17-51" data-line-number="51"><span class="va">created=</span><span class="st">&quot;</span><span class="va">${created:0:${afterPos}}</span><span class="st">:</span><span class="va">${created:${afterPos}}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-52" data-line-number="52"></a>
<a class="sourceLine" id="cb17-53" data-line-number="53"><span class="co"># Full label namespace with unique image id prepended</span></a>
<a class="sourceLine" id="cb17-54" data-line-number="54"><span class="va">NS=</span><span class="st">&quot;</span><span class="va">${imageRepoOwner}</span><span class="st">.</span><span class="va">${imageName}</span><span class="st">.</span><span class="va">${labelSchema}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-55" data-line-number="55"></a>
<a class="sourceLine" id="cb17-56" data-line-number="56"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-57" data-line-number="57"><span class="co"># Build command.</span></a>
<a class="sourceLine" id="cb17-58" data-line-number="58"><span class="co">###</span></a>
<a class="sourceLine" id="cb17-59" data-line-number="59"></a>
<a class="sourceLine" id="cb17-60" data-line-number="60"><span class="ex">docker</span> build \</a>
<a class="sourceLine" id="cb17-61" data-line-number="61">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.base-prefix=</span><span class="va">${baseImagePrefix}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-62" data-line-number="62">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.name=</span><span class="va">${imageName}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-63" data-line-number="63">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.home=</span><span class="va">${imageRepoRootUrl}</span><span class="st">/</span><span class="va">${imageRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-64" data-line-number="64">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.version=</span><span class="va">${TAG}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-65" data-line-number="65">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.maintainer=</span><span class="va">${maintainer}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-66" data-line-number="66">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.source-version=</span><span class="va">${sourceVersion}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-67" data-line-number="67">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.source-home=</span><span class="va">${sourceRepoRootUrl}</span><span class="st">/</span><span class="va">${sourceRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-68" data-line-number="68">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.source-maintainer=</span><span class="va">${maintainer}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-69" data-line-number="69">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.pull=</span><span class="va">${imageRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">:</span><span class="va">$TAG</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-70" data-line-number="70">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.license-spdx=</span><span class="va">${spdxLicense}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-71" data-line-number="71">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.license-file=</span><span class="va">${licenseFile}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-72" data-line-number="72">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.vendor=</span><span class="va">${vendor}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-73" data-line-number="73">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.vendorUrl=</span><span class="va">${vendorUrl}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-74" data-line-number="74">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.title=</span><span class="va">${title}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-75" data-line-number="75">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.description=</span><span class="va">${description}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-76" data-line-number="76">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-home=</span><span class="va">${contentHome}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-77" data-line-number="77">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-version=</span><span class="va">${contentVersion}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-78" data-line-number="78">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-source=</span><span class="va">${contentSource}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-79" data-line-number="79">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-license-spdx=</span><span class="va">${contentSpdxLicense}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-80" data-line-number="80">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-license-file=</span><span class="va">${contentLicenseFile}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-81" data-line-number="81">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-vendor=</span><span class="va">${contentVendor}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-82" data-line-number="82">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-vendorUrl=</span><span class="va">${contentVendorUrl}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-83" data-line-number="83">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-title=</span><span class="va">${contentTitle}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-84" data-line-number="84">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.content-description=</span><span class="va">${contentDescription}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-85" data-line-number="85">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.created=</span><span class="va">${created}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-86" data-line-number="86">  --label <span class="st">&quot;</span><span class="va">${NS}</span><span class="st">.label-schema-version=</span><span class="va">${labelSchemaVersion}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-87" data-line-number="87">  --tag <span class="st">&quot;</span><span class="va">${imageRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">:latest&quot;</span> \</a>
<a class="sourceLine" id="cb17-88" data-line-number="88">  --tag <span class="st">&quot;</span><span class="va">${imageRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">:</span><span class="va">${contentVersion}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-89" data-line-number="89">  --tag <span class="st">&quot;</span><span class="va">${imageRepoOwner}</span><span class="st">/</span><span class="va">${imageName}</span><span class="st">:</span><span class="va">${contentVersion}</span><span class="st">-</span><span class="va">${sourceVersion}</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb17-90" data-line-number="90">  -f <span class="va">${dockerfilePath}</span> \</a>
<a class="sourceLine" id="cb17-91" data-line-number="91">  .</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="build-methodology.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="other-label-schemas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["JefferysDockers.github.io.pdf", "JefferysDockers.github.io.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
